(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../meta"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("markdown",function(n,m){var B=A.modes.hasOwnProperty("xml");var h=A.getMode(n,B?{name:"xml",htmlMode:true}:"text/plain");function v(y){if(A.findModeByName){var z=A.findModeByName(y);if(z){y=z.mime||z.mimes[0]}}var x=A.getMode(n,y);return x.name=="null"?null:x}if(m.highlightFormatting===undefined){m.highlightFormatting=false}if(m.maxBlockquoteDepth===undefined){m.maxBlockquoteDepth=0}if(m.underscoresBreakWords===undefined){m.underscoresBreakWords=true}if(m.fencedCodeBlocks===undefined){m.fencedCodeBlocks=false}if(m.taskLists===undefined){m.taskLists=false}if(m.strikethrough===undefined){m.strikethrough=false}var j=0;var H="header",J="comment",Z="quote",f="variable-2",M="variable-3",L="keyword",I="hr",N="tag",V="formatting",P="link",T="link",l="link",K="string",C="em",u="strong",t="strikethrough";var D=/^([*\-_])(?:\s*\1){2,}\s*$/,E=/^[*\-+]\s+/,a=/^[0-9]+([.)])\s+/,U=/^\[(x| )\](?=\s)/,O=/^(#+)(?: |$)/,p=/^ *(?:\={1,}|-{1,})\s*$/,X=/^[^#!\[\]*_\\<>` "'(~]+/;function r(z,y,x){y.f=y.inline=x;return x(z,y)}function S(z,y,x){y.f=y.block=x;return x(z,y)}function R(x){x.linkTitle=false;x.em=false;x.strong=false;x.strikethrough=false;x.quote=0;x.indentedCode=false;if(!B&&x.f==Y){x.f=e;x.block=g}x.trailingSpace=0;x.trailingSpaceNewLine=false;x.thisLineHasContent=false;return null}function g(Ad,Ab){var y=Ad.sol();var z=Ab.list!==false,Ac=Ab.indentedCode;Ab.indentedCode=false;if(z){if(Ab.indentationDiff>=0){if(Ab.indentationDiff<4){Ab.indentation-=Ab.indentationDiff}Ab.list=null}else{if(Ab.indentation>0){Ab.list=null;Ab.listDepth=Math.floor(Ab.indentation/4)}else{Ab.list=false;Ab.listDepth=0}}}var x=null;if(Ab.indentationDiff>=4){Ad.skipToEnd();if(Ac||!Ab.prevLineHasContent){Ab.indentation-=4;Ab.indentedCode=true;return J}else{return null}}else{if(Ad.eatSpace()){return null}else{if((x=Ad.match(O))&&x[1].length<=6){Ab.header=x[1].length;if(m.highlightFormatting){Ab.formatting="header"}Ab.f=Ab.inline;return G(Ab)}else{if(Ab.prevLineHasContent&&!Ab.quote&&!z&&!Ac&&(x=Ad.match(p))){Ab.header=x[0].charAt(0)=="="?1:2;if(m.highlightFormatting){Ab.formatting="header"}Ab.f=Ab.inline;return G(Ab)}else{if(Ad.eat(">")){Ab.quote=y?1:Ab.quote+1;if(m.highlightFormatting){Ab.formatting="quote"}Ad.eatSpace();return G(Ab)}else{if(Ad.peek()==="["){return r(Ad,Ab,Q)}else{if(Ad.match(D,true)){Ab.hr=true;return I}else{if((!Ab.prevLineHasContent||z)&&(Ad.match(E,false)||Ad.match(a,false))){var Aa=null;if(Ad.match(E,true)){Aa="ul"}else{Ad.match(a,true);Aa="ol"}Ab.indentation+=4;Ab.list=true;Ab.listDepth++;if(m.taskLists&&Ad.match(U,false)){Ab.taskList=true}Ab.f=Ab.inline;if(m.highlightFormatting){Ab.formatting=["list","list-"+Aa]}return G(Ab)}else{if(m.fencedCodeBlocks&&Ad.match(/^```[ \t]*([\w+#]*)/,true)){Ab.localMode=v(RegExp.$1);if(Ab.localMode){Ab.localState=Ab.localMode.startState()}Ab.f=Ab.block=i;if(m.highlightFormatting){Ab.formatting="code-block"}Ab.code=true;return G(Ab)}}}}}}}}}return r(Ad,Ab,Ab.inline)}function Y(z,y){var x=h.token(z,y.htmlState);if((B&&y.htmlState.tagStart===null&&(!y.htmlState.context&&y.htmlState.tokenize.isInText))||(y.md_inside&&z.current().indexOf(">")>-1)){y.f=e;y.block=g;y.htmlState=null}return x}function i(y,x){if(y.sol()&&y.match("```",false)){x.localMode=x.localState=null;x.f=x.block=k;return null}else{if(x.localMode){return x.localMode.token(y,x.localState)}else{y.skipToEnd();return J}}}function k(z,y){z.match("```");y.block=g;y.f=e;if(m.highlightFormatting){y.formatting="code-block"}y.code=true;var x=G(y);y.code=false;return x}function G(Aa){var z=[];if(Aa.formatting){z.push(V);if(typeof Aa.formatting==="string"){Aa.formatting=[Aa.formatting]}for(var x=0;x<Aa.formatting.length;x++){z.push(V+"-"+Aa.formatting[x]);if(Aa.formatting[x]==="header"){z.push(V+"-"+Aa.formatting[x]+"-"+Aa.header)}if(Aa.formatting[x]==="quote"){if(!m.maxBlockquoteDepth||m.maxBlockquoteDepth>=Aa.quote){z.push(V+"-"+Aa.formatting[x]+"-"+Aa.quote)}else{z.push("error")}}}}if(Aa.taskOpen){z.push("meta");return z.length?z.join(" "):null}if(Aa.taskClosed){z.push("property");return z.length?z.join(" "):null}if(Aa.linkHref){z.push(K,"url")}else{if(Aa.strong){z.push(u)}if(Aa.em){z.push(C)}if(Aa.strikethrough){z.push(t)}if(Aa.linkText){z.push(l)}if(Aa.code){z.push(J)}}if(Aa.header){z.push(H);z.push(H+"-"+Aa.header)}if(Aa.quote){z.push(Z);if(!m.maxBlockquoteDepth||m.maxBlockquoteDepth>=Aa.quote){z.push(Z+"-"+Aa.quote)}else{z.push(Z+"-"+m.maxBlockquoteDepth)}}if(Aa.list!==false){var y=(Aa.listDepth-1)%3;if(!y){z.push(f)}else{if(y===1){z.push(M)}else{z.push(L)}}}if(Aa.trailingSpaceNewLine){z.push("trailing-space-new-line")}else{if(Aa.trailingSpace){z.push("trailing-space-"+(Aa.trailingSpace%2?"a":"b"))}}return z.length?z.join(" "):null}function d(y,x){if(y.match(X,true)){return G(x)}return undefined}function e(Am,Aa){var Ao=Aa.text(Am,Aa);if(typeof Ao!=="undefined"){return Ao}if(Aa.list){Aa.list=null;return G(Aa)}if(Aa.taskList){var Aj=Am.match(U,true)[1]!=="x";if(Aj){Aa.taskOpen=true}else{Aa.taskClosed=true}if(m.highlightFormatting){Aa.formatting="task"}Aa.taskList=false;return G(Aa)}Aa.taskOpen=false;Aa.taskClosed=false;if(Aa.header&&Am.match(/^#+$/,true)){if(m.highlightFormatting){Aa.formatting="header"}return G(Aa)}var Al=Am.sol();var Ad=Am.next();if(Ad==="\\"){Am.next();if(m.highlightFormatting){var An=G(Aa);return An?An+" formatting-escape":"formatting-escape"}}if(Aa.linkTitle){Aa.linkTitle=false;var x=Ad;if(Ad==="("){x=")"}x=(x+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var Ae="^\\s*(?:[^"+x+"\\\\]+|\\\\\\\\|\\\\.)"+x;if(Am.match(new RegExp(Ae),true)){return K}}if(Ad==="`"){var Af=Aa.formatting;if(m.highlightFormatting){Aa.formatting="code"}var z=G(Aa);var Ab=Am.pos;Am.eatWhile("`");var Ag=1+Am.pos-Ab;if(!Aa.code){j=Ag;Aa.code=true;return G(Aa)}else{if(Ag===j){Aa.code=false;return z}Aa.formatting=Af;return G(Aa)}}else{if(Aa.code){return G(Aa)}}if(Ad==="!"&&Am.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){Am.match(/\[[^\]]*\]/);Aa.inline=Aa.f=o;return N}if(Ad==="["&&Am.match(/.*\](\(.*\)| ?\[.*\])/,false)){Aa.linkText=true;if(m.highlightFormatting){Aa.formatting="link"}return G(Aa)}if(Ad==="]"&&Aa.linkText&&Am.match(/\(.*\)| ?\[.*\]/,false)){if(m.highlightFormatting){Aa.formatting="link"}var An=G(Aa);Aa.linkText=false;Aa.inline=Aa.f=o;return An}if(Ad==="<"&&Am.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){Aa.f=Aa.inline=b;if(m.highlightFormatting){Aa.formatting="link"}var An=G(Aa);if(An){An+=" "}else{An=""}return An+P}if(Ad==="<"&&Am.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){Aa.f=Aa.inline=b;if(m.highlightFormatting){Aa.formatting="link"}var An=G(Aa);if(An){An+=" "}else{An=""}return An+T}if(Ad==="<"&&Am.match(/^(!--|\w)/,false)){var Ac=Am.string.indexOf(">",Am.pos);if(Ac!=-1){var Ai=Am.string.substring(Am.start,Ac);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(Ai)){Aa.md_inside=true}}Am.backUp(1);Aa.htmlState=A.startState(h);return S(Am,Aa,Y)}if(Ad==="<"&&Am.match(/^\/\w*?>/)){Aa.md_inside=false;return"tag"}var y=false;if(!m.underscoresBreakWords){if(Ad==="_"&&Am.peek()!=="_"&&Am.match(/(\w)/,false)){var Ak=Am.pos-2;if(Ak>=0){var Ah=Am.string.charAt(Ak);if(Ah!=="_"&&Ah.match(/(\w)/,false)){y=true}}}}if(Ad==="*"||(Ad==="_"&&!y)){if(Al&&Am.peek()===" "){}else{if(Aa.strong===Ad&&Am.eat(Ad)){if(m.highlightFormatting){Aa.formatting="strong"}var z=G(Aa);Aa.strong=false;return z}else{if(!Aa.strong&&Am.eat(Ad)){Aa.strong=Ad;if(m.highlightFormatting){Aa.formatting="strong"}return G(Aa)}else{if(Aa.em===Ad){if(m.highlightFormatting){Aa.formatting="em"}var z=G(Aa);Aa.em=false;return z}else{if(!Aa.em){Aa.em=Ad;if(m.highlightFormatting){Aa.formatting="em"}return G(Aa)}}}}}}else{if(Ad===" "){if(Am.eat("*")||Am.eat("_")){if(Am.peek()===" "){return G(Aa)}else{Am.backUp(1)}}}}if(m.strikethrough){if(Ad==="~"&&Am.eatWhile(Ad)){if(Aa.strikethrough){if(m.highlightFormatting){Aa.formatting="strikethrough"}var z=G(Aa);Aa.strikethrough=false;return z}else{if(Am.match(/^[^\s]/,false)){Aa.strikethrough=true;if(m.highlightFormatting){Aa.formatting="strikethrough"}return G(Aa)}}}else{if(Ad===" "){if(Am.match(/^~~/,true)){if(Am.peek()===" "){return G(Aa)}else{Am.backUp(2)}}}}}if(Ad===" "){if(Am.match(/ +$/,false)){Aa.trailingSpace++}else{if(Aa.trailingSpace){Aa.trailingSpaceNewLine=true}}}return G(Aa)}function b(Aa,z){var y=Aa.next();if(y===">"){z.f=z.inline=e;if(m.highlightFormatting){z.formatting="link"}var x=G(z);if(x){x+=" "}else{x=""}return x+P}Aa.match(/^[^>]+/,true);return P}function o(z,y){if(z.eatSpace()){return null}var x=z.next();if(x==="("||x==="["){y.f=y.inline=q(x==="("?")":"]");if(m.highlightFormatting){y.formatting="link-string"}y.linkHref=true;return G(y)}return"error"}function q(x){return function(Ab,Aa){var z=Ab.next();if(z===x){Aa.f=Aa.inline=e;if(m.highlightFormatting){Aa.formatting="link-string"}var y=G(Aa);Aa.linkHref=false;return y}if(Ab.match(c(x),true)){Ab.backUp(1)}Aa.linkHref=true;return G(Aa)}}function Q(y,x){if(y.match(/^[^\]]*\]:/,false)){x.f=s;y.next();if(m.highlightFormatting){x.formatting="link"}x.linkText=true;return G(x)}return r(y,x,e)}function s(z,y){if(z.match(/^\]:/,true)){y.f=y.inline=w;if(m.highlightFormatting){y.formatting="link"}var x=G(y);y.linkText=false;return x}z.match(/^[^\]]+/,true);return l}function w(y,x){if(y.eatSpace()){return null}y.match(/^[^\s]+/,true);if(y.peek()===undefined){x.linkTitle=true}else{y.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}x.f=x.inline=e;return K+" url"}var W=[];function c(x){if(!W[x]){x=(x+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");W[x]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+x+")")}return W[x]}var F={startState:function(){return{f:g,prevLineHasContent:false,thisLineHasContent:false,block:g,htmlState:null,indentation:0,inline:e,text:d,formatting:false,linkText:false,linkHref:false,linkTitle:false,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false}},copyState:function(x){return{f:x.f,prevLineHasContent:x.prevLineHasContent,thisLineHasContent:x.thisLineHasContent,block:x.block,htmlState:x.htmlState&&A.copyState(h,x.htmlState),indentation:x.indentation,localMode:x.localMode,localState:x.localMode?A.copyState(x.localMode,x.localState):null,inline:x.inline,text:x.text,formatting:false,linkTitle:x.linkTitle,em:x.em,strong:x.strong,strikethrough:x.strikethrough,header:x.header,hr:x.hr,taskList:x.taskList,list:x.list,listDepth:x.listDepth,quote:x.quote,indentedCode:x.indentedCode,trailingSpace:x.trailingSpace,trailingSpaceNewLine:x.trailingSpaceNewLine,md_inside:x.md_inside}},token:function(Ac,Aa){Aa.formatting=false;if(Ac.sol()){var y=!!Aa.header||Aa.hr;Aa.header=0;Aa.hr=false;if(Ac.match(/^\s*$/,true)||y){Aa.prevLineHasContent=false;R(Aa);return y?this.token(Ac,Aa):null}else{Aa.prevLineHasContent=Aa.thisLineHasContent;Aa.thisLineHasContent=true}Aa.taskList=false;Aa.code=false;Aa.trailingSpace=0;Aa.trailingSpaceNewLine=false;Aa.f=Aa.block;var x=Ac.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;var z=Math.floor((x-Aa.indentation)/4)*4;if(z>4){z=4}var Ab=Aa.indentation+z;Aa.indentationDiff=Ab-Aa.indentation;Aa.indentation=Ab;if(x>0){return null}}return Aa.f(Ac,Aa)},innerMode:function(x){if(x.block==Y){return{state:x.htmlState,mode:h}}if(x.localState){return{state:x.localState,mode:x.localMode}}return{state:x,mode:F}},blankLine:R,getType:G,fold:"markdown"};return F},"xml");A.defineMIME("text/x-markdown","markdown")});