(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("django:inner",function(){var E=["block","endblock","for","endfor","true","false","loop","none","self","super","if","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],I=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],D=["==","!=","<",">","<=",">=","in","not","or","and"];E=new RegExp("^\\b("+E.join("|")+")\\b");I=new RegExp("^\\b("+I.join("|")+")\\b");D=new RegExp("^\\b("+D.join("|")+")\\b");function F(L,K){if(L.match("{{")){K.tokenize=H;return"tag"}else{if(L.match("{%")){K.tokenize=C;return"tag"}else{if(L.match("{#")){K.tokenize=B;return"comment"}}}while(L.next()!=null&&!L.match("{{",false)&&!L.match("{%",false)){}return null}function J(K,L){return function(O,N){if(!N.escapeNext&&O.eat(K)){N.tokenize=L}else{if(N.escapeNext){N.escapeNext=false}var M=O.next();if(M=="\\"){N.escapeNext=true}}return"string"}}function H(L,K){if(K.waitDot){K.waitDot=false;if(L.peek()!="."){return"null"}if(L.match(/\.\W+/)){return"error"}else{if(L.eat(".")){K.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(K.waitPipe){K.waitPipe=false;if(L.peek()!="|"){return"null"}if(L.match(/\.\W+/)){return"error"}else{if(L.eat("|")){K.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(K.waitProperty){K.waitProperty=false;if(L.match(/\b(\w+)\b/)){K.waitDot=true;K.waitPipe=true;return"property"}}if(K.waitFilter){K.waitFilter=false;if(L.match(I)){return"variable-2"}}if(L.eatSpace()){K.waitProperty=false;return"null"}if(L.match(/\b\d+(\.\d+)?\b/)){return"number"}if(L.match("'")){K.tokenize=J("'",K.tokenize);return"string"}else{if(L.match('"')){K.tokenize=J('"',K.tokenize);return"string"}}if(L.match(/\b(\w+)\b/)&&!K.foundVariable){K.waitDot=true;K.waitPipe=true;return"variable"}if(L.match("}}")){K.waitProperty=null;K.waitFilter=null;K.waitDot=null;K.waitPipe=null;K.tokenize=F;return"tag"}L.next();return"null"}function C(M,L){if(L.waitDot){L.waitDot=false;if(M.peek()!="."){return"null"}if(M.match(/\.\W+/)){return"error"}else{if(M.eat(".")){L.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(L.waitPipe){L.waitPipe=false;if(M.peek()!="|"){return"null"}if(M.match(/\.\W+/)){return"error"}else{if(M.eat("|")){L.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(L.waitProperty){L.waitProperty=false;if(M.match(/\b(\w+)\b/)){L.waitDot=true;L.waitPipe=true;return"property"}}if(L.waitFilter){L.waitFilter=false;if(M.match(I)){return"variable-2"}}if(M.eatSpace()){L.waitProperty=false;return"null"}if(M.match(/\b\d+(\.\d+)?\b/)){return"number"}if(M.match("'")){L.tokenize=J("'",L.tokenize);return"string"}else{if(M.match('"')){L.tokenize=J('"',L.tokenize);return"string"}}if(M.match(D)){return"operator"}var K=M.match(E);if(K){if(K[0]=="comment"){L.blockCommentTag=true}return"keyword"}if(M.match(/\b(\w+)\b/)){L.waitDot=true;L.waitPipe=true;return"variable"}if(M.match("%}")){L.waitProperty=null;L.waitFilter=null;L.waitDot=null;L.waitPipe=null;if(L.blockCommentTag){L.blockCommentTag=false;L.tokenize=G}else{L.tokenize=F}return"tag"}M.next();return"null"}function B(L,K){if(L.match("#}")){K.tokenize=F}return"comment"}function G(L,K){if(L.match(/\{%\s*endcomment\s*%\}/,false)){K.tokenize=C;L.match("{%");return"tag"}else{L.next();return"comment"}}return{startState:function(){return{tokenize:F}},token:function(L,K){return K.tokenize(L,K)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}});A.defineMode("django",function(C){var B=A.getMode(C,"text/html");var D=A.getMode(C,"django:inner");return A.overlayMode(B,D)});A.defineMIME("text/x-django","django")});