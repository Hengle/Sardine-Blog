(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed"],A)}else{A(CodeMirror)}}})(function(A){var B=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];A.defineMode("soy",function(F){var D=A.getMode(F,"text/plain");var C={html:A.getMode(F,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:false}),attributes:D,text:D,uri:D,css:A.getMode(F,"text/css"),js:A.getMode(F,{name:"text/javascript",statementIndent:2*F.indentUnit})};function G(H){return H[H.length-1]}function E(M,K,L){var J=M.string;var I=L.exec(J.substr(M.pos));if(I){M.string=J.substr(0,M.pos+I.index)}var H=M.hideFirstChars(K.indent,function(){return K.localMode.token(M,K.localState)});M.string=J;return H}return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:C.html,localState:A.startState(C.html)}},copyState:function(H){return{tag:H.tag,kind:H.kind.concat([]),kindTag:H.kindTag.concat([]),soyState:H.soyState.concat([]),indent:H.indent,localMode:H.localMode,localState:A.copyState(H.localMode,H.localState)}},token:function(K,J){var H;switch(G(J.soyState)){case"comment":if(K.match(/^.*?\*\//)){J.soyState.pop()}else{K.skipToEnd()}return"comment";case"variable":if(K.match(/^}/)){J.indent-=2*F.indentUnit;J.soyState.pop();return"variable-2"}K.next();return null;case"tag":if(K.match(/^\/?}/)){if(J.tag=="/template"||J.tag=="/deltemplate"){J.indent=0}else{J.indent-=(K.current()=="/}"||B.indexOf(J.tag)==-1?2:1)*F.indentUnit}J.soyState.pop();return"keyword"}else{if(K.match(/^([\w?]+)(?==)/)){if(K.current()=="kind"&&(H=K.match(/^="([^"]+)/,false))){var I=H[1];J.kind.push(I);J.kindTag.push(J.tag);J.localMode=C[I]||C.html;J.localState=A.startState(J.localMode)}return"attribute"}else{if(K.match(/^"/)){J.soyState.push("string");return"string"}}}K.next();return null;case"literal":if(K.match(/^(?=\{\/literal})/)){J.indent-=F.indentUnit;J.soyState.pop();return this.token(K,J)}return E(K,J,/\{\/literal}/);case"string":if(K.match(/^.*?"/)){J.soyState.pop()}else{K.skipToEnd()}return"string"}if(K.match(/^\/\*/)){J.soyState.push("comment");return"comment"}else{if(K.match(K.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)){return"comment"}else{if(K.match(/^\{\$[\w?]*/)){J.indent+=2*F.indentUnit;J.soyState.push("variable");return"variable-2"}else{if(K.match(/^\{literal}/)){J.indent+=F.indentUnit;J.soyState.push("literal");return"keyword"}else{if(H=K.match(/^\{([\/@\\]?[\w?]*)/)){if(H[1]!="/switch"){J.indent+=(/^(\/|(else|elseif|case|default)$)/.test(H[1])&&J.tag!="switch"?1:2)*F.indentUnit}J.tag=H[1];if(J.tag=="/"+G(J.kindTag)){J.kind.pop();J.kindTag.pop();J.localMode=C[G(J.kind)]||C.html;J.localState=A.startState(J.localMode)}J.soyState.push("tag");return"keyword"}}}}}return E(K,J,/\{|\s+\/\/|\/\*/)},indent:function(K,H){var J=K.indent,I=G(K.soyState);if(I=="comment"){return A.Pass}if(I=="literal"){if(/^\{\/literal}/.test(H)){J-=F.indentUnit}}else{if(/^\s*\{\/(template|deltemplate)\b/.test(H)){return 0}if(/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(H)){J-=F.indentUnit}if(K.tag!="switch"&&/^\{(case|default)\b/.test(H)){J-=F.indentUnit}if(/^\{\/switch\b/.test(H)){J-=F.indentUnit}}if(J&&K.localMode.indent){J+=K.localMode.indent(K.localState,H)}return J},innerMode:function(H){if(H.soyState.length&&G(H.soyState)!="literal"){return null}else{return{state:H.localState,mode:H.localMode}}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed");A.registerHelper("hintWords","soy",B.concat(["delpackage","namespace","alias","print","css","debugger"]));A.defineMIME("text/x-soy","soy")});