(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(F){var C="CodeMirror-lint-markers";function B(S,V){var U=document.createElement("div");U.className="CodeMirror-lint-tooltip";U.appendChild(V.cloneNode(true));document.body.appendChild(U);function T(W){if(!U.parentNode){return F.off(document,"mousemove",T)}U.style.top=Math.max(0,W.clientY-U.offsetHeight-5)+"px";U.style.left=(W.clientX+5)+"px"}F.on(document,"mousemove",T);T(S);if(U.style.opacity!=null){U.style.opacity=1}return U}function H(S){if(S.parentNode){S.parentNode.removeChild(S)}}function Q(S){if(!S.parentNode){return}if(S.style.opacity==null){H(S)}S.style.opacity=0;setTimeout(function(){H(S)},600)}function G(S,V,T){var U=B(S,V);function X(){F.off(T,"mouseout",X);if(U){Q(U);U=null}}var W=setInterval(function(){if(U){for(var Y=T;;Y=Y.parentNode){if(Y&&Y.nodeType==11){Y=Y.host}if(Y==document.body){return}if(!Y){X();break}}}if(!U){return clearInterval(W)}},400);F.on(T,"mouseout",X)}function E(U,T,S){this.marked=[];this.options=T;this.timeout=null;this.hasGutter=S;this.onMouseOver=function(V){R(U,V)}}function L(T,S){if(S instanceof Function){return{getAnnotations:S}}if(!S||S===true){S={}}return S}function I(T){var U=T.state.lint;if(U.hasGutter){T.clearGutter(C)}for(var S=0;S<U.marked.length;++S){U.marked[S].clear()}U.marked.length=0}function P(W,U,S,X){var T=document.createElement("div"),V=T;T.className="CodeMirror-lint-marker-"+U;if(S){V=T.appendChild(document.createElement("div"));V.className="CodeMirror-lint-marker-multiple"}if(X!=false){F.on(V,"mouseover",function(Y){G(Y,W,V)})}return T}function D(T,S){if(T=="error"){return T}else{return S}}function N(V){var T=[];for(var S=0;S<V.length;++S){var U=V[S],W=U.from.line;(T[W]||(T[W]=[])).push(U)}return T}function O(T){var U=T.severity;if(!U){U="error"}var S=document.createElement("div");S.className="CodeMirror-lint-message-"+U;S.appendChild(document.createTextNode(T.message));return S}function J(V){var W=V.state.lint,T=W.options;var U=T.options||T;var S=T.getAnnotations||V.getHelper(F.Pos(0,0),"lint");if(!S){return}if(T.async||S.async){S(V.getValue(),A,U,V)}else{A(V,S(V.getValue(),U,V))}}function A(U,d){I(U);var X=U.state.lint,Y=X.options;var S=N(d);for(var T=0;T<S.length;++T){var c=S[T];if(!c){continue}var V=null;var a=X.hasGutter&&document.createDocumentFragment();for(var Z=0;Z<c.length;++Z){var W=c[Z];var b=W.severity;if(!b){b="error"}V=D(V,b);if(Y.formatAnnotation){W=Y.formatAnnotation(W)}if(X.hasGutter){a.appendChild(O(W))}if(W.to){X.marked.push(U.markText(W.from,W.to,{className:"CodeMirror-lint-mark-"+b,__annotation:W}))}}if(X.hasGutter){U.setGutterMarker(T,C,P(a,V,c.length>1,X.options.tooltips))}}if(Y.onUpdateLinting){Y.onUpdateLinting(d,S,U)}}function K(S){var T=S.state.lint;if(!T){return}clearTimeout(T.timeout);T.timeout=setTimeout(function(){J(S)},T.options.delay||500)}function M(T,S){var U=S.target||S.srcElement;G(S,O(T),U)}function R(U,S){var Y=S.target||S.srcElement;if(!/\bCodeMirror-lint-mark-/.test(Y.className)){return}var V=Y.getBoundingClientRect(),Z=(V.left+V.right)/2,a=(V.top+V.bottom)/2;var T=U.findMarksAt(U.coordsChar({left:Z,top:a},"client"));for(var W=0;W<T.length;++W){var X=T[W].__annotation;if(X){return M(X,S)}}}F.defineOption("lint",false,function(X,W,U){if(U&&U!=F.Init){I(X);X.off("change",K);F.off(X.getWrapperElement(),"mouseover",X.state.lint.onMouseOver);clearTimeout(X.state.lint.timeout);delete X.state.lint}if(W){var V=X.getOption("gutters"),S=false;for(var T=0;T<V.length;++T){if(V[T]==C){S=true}}var Y=X.state.lint=new E(X,L(X,W),S);X.on("change",K);if(Y.options.tooltips!=false){F.on(X.getWrapperElement(),"mouseover",Y.onMouseOver)}J(X)}})});