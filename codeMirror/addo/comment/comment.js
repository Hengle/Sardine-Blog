(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(D){var B={};var A=/[^\s\u00a0]/;var E=D.Pos;function C(F){var G=F.search(A);return G==-1?0:G}D.commands.toggleComment=function(L){var I=Infinity,G=L.listSelections(),J=null;for(var F=G.length-1;F>=0;F--){var H=G[F].from(),K=G[F].to();if(H.line>=I){continue}if(K.line>=I){K=E(I,0)}I=H.line;if(J==null){if(L.uncomment(H,K)){J="un"}else{L.lineComment(H,K);J="line"}}else{if(J=="un"){L.uncomment(H,K)}else{L.lineComment(H,K)}}}};D.defineExtension("lineComment",function(I,M,H){if(!H){H=B}var L=this,J=L.getModeAt(I);var K=H.lineComment||J.lineComment;if(!K){if(H.blockCommentStart||J.blockCommentStart){H.fullLines=true;L.blockComment(I,M,H)}return}var O=L.getLine(I.line);if(O==null){return}var F=Math.min(M.ch!=0||M.line==I.line?M.line+1:M.line,L.lastLine()+1);var N=H.padding==null?" ":H.padding;var G=H.commentBlankLines||I.line==M.line;L.operation(function(){if(H.indent){var P=O.slice(0,C(O));for(var Q=I.line;Q<F;++Q){var S=L.getLine(Q),R=P.length;if(!G&&!A.test(S)){continue}if(S.slice(0,R)!=P){R=C(S)}L.replaceRange(P+K+N,E(Q,0),E(Q,R))}}else{for(var Q=I.line;Q<F;++Q){if(G||A.test(L.getLine(Q))){L.replaceRange(K+N,E(Q,0))}}}})});D.defineExtension("blockComment",function(J,M,I){if(!I){I=B}var L=this,K=L.getModeAt(J);var N=I.blockCommentStart||K.blockCommentStart;var G=I.blockCommentEnd||K.blockCommentEnd;if(!N||!G){if((I.lineComment||K.lineComment)&&I.fullLines!=false){L.lineComment(J,M,I)}return}var H=Math.min(M.line,L.lastLine());if(H!=J.line&&M.ch==0&&A.test(L.getLine(H))){--H}var F=I.padding==null?" ":I.padding;if(J.line>H){return}L.operation(function(){if(I.fullLines!=false){var Q=A.test(L.getLine(H));L.replaceRange(F+G,E(H));L.replaceRange(N+F,E(J.line,0));var P=I.blockCommentLead||K.blockCommentLead;if(P!=null){for(var O=J.line+1;O<=H;++O){if(O!=H||Q){L.replaceRange(P+F,E(O,0))}}}}else{L.replaceRange(G,M);L.replaceRange(N,J)}})});D.defineExtension("uncomment",function(R,F,V){if(!V){V=B}var b=this,H=b.getModeAt(R);var P=Math.min(F.ch!=0||F.line==R.line?F.line:F.line-1,b.lastLine()),G=Math.min(R.line,P);var W=V.lineComment||H.lineComment,S=[];var N=V.padding==null?" ":V.padding,U;lineComment:{if(!W){break lineComment}for(var X=G;X<=P;++X){var J=b.getLine(X);var Q=J.indexOf(W);if(Q>-1&&!/comment/.test(b.getTokenTypeAt(E(X,Q+1)))){Q=-1}if(Q==-1&&(X!=P||X==G)&&A.test(J)){break lineComment}if(Q>-1&&A.test(J.slice(0,Q))){break lineComment}S.push(J)}b.operation(function(){for(var d=G;d<=P;++d){var g=S[d-G];var e=g.indexOf(W),f=e+W.length;if(e<0){continue}if(g.slice(f,f+N.length)==N){f+=N.length}U=true;b.replaceRange("",E(d,e),E(d,f))}});if(U){return true}}var L=V.blockCommentStart||H.blockCommentStart;var a=V.blockCommentEnd||H.blockCommentEnd;if(!L||!a){return false}var I=V.blockCommentLead||H.blockCommentLead;var M=b.getLine(G),Z=P==G?M:b.getLine(P);var c=M.indexOf(L),K=Z.lastIndexOf(a);if(K==-1&&G!=P){Z=b.getLine(--P);K=Z.lastIndexOf(a)}if(c==-1||K==-1||!/comment/.test(b.getTokenTypeAt(E(G,c+1)))||!/comment/.test(b.getTokenTypeAt(E(P,K+1)))){return false}var Y=M.lastIndexOf(L,R.ch);var O=Y==-1?-1:M.slice(0,R.ch).indexOf(a,Y+L.length);if(Y!=-1&&O!=-1&&O+a.length!=R.ch){return false}O=Z.indexOf(a,F.ch);var T=Z.slice(F.ch).lastIndexOf(L,O-F.ch);Y=(O==-1||T==-1)?-1:F.ch+T;if(O!=-1&&Y!=-1&&Y!=F.ch){return false}b.operation(function(){b.replaceRange("",E(P,K-(N&&Z.slice(K-N.length,K)==N?N.length:0)),E(P,K+a.length));var d=c+L.length;if(N&&M.slice(d,d+N.length)==N){d+=N.length}b.replaceRange("",E(G,c),E(G,d));if(I){for(var e=G+1;e<=P;++e){var g=b.getLine(e),h=g.indexOf(I);if(h==-1||A.test(g.slice(0,h))){continue}var f=h+I.length;if(N&&g.slice(f,f+N.length)==N){f+=N.length}b.replaceRange("",E(e,h),E(e,f))}}});return true})});