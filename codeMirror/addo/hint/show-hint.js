(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(I){var H="CodeMirror-hint";var B="CodeMirror-hint-active";I.showHint=function(P,M,L){if(!M){return P.showHint(L)}if(L&&L.async){M.async=true}var O={hint:M};if(L){for(var N in L){O[N]=L[N]}}return P.showHint(O)};I.defineExtension("showHint",function(L){if(this.listSelections().length>1||this.somethingSelected()){return}if(this.state.completionActive){this.state.completionActive.close()}var M=this.state.completionActive=new K(this,L);if(!M.options.hint){return}I.signal(this,"startCompletion",this);M.update(true)});function K(N,M){this.cm=N;this.options=this.buildOptions(M);this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor();this.startLen=this.cm.getLine(this.startPos.line).length;var L=this;N.on("cursorActivity",this.activityFunc=function(){L.cursorActivity()})}var E=window.requestAnimationFrame||function(L){return setTimeout(L,1000/60)};var F=window.cancelAnimationFrame||clearTimeout;K.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data){I.signal(this.data,"close")}if(this.widget){this.widget.close()}I.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(N,L){var M=N.list[L];if(M.hint){M.hint(this.cm,N,M)}else{this.cm.replaceRange(D(M),M.from||N.from,M.to||N.to,"complete")}I.signal(N,"pick",M);this.close()},cursorActivity:function(){if(this.debounce){F(this.debounce);this.debounce=0}var M=this.cm.getCursor(),N=this.cm.getLine(M.line);if(M.line!=this.startPos.line||N.length-M.ch!=this.startLen-this.startPos.ch||M.ch<this.startPos.ch||this.cm.somethingSelected()||(M.ch&&this.options.closeCharacters.test(N.charAt(M.ch-1)))){this.close()}else{var L=this;this.debounce=E(function(){L.update()});if(this.widget){this.widget.disable()}}},update:function(N){if(this.tick==null){return}if(!this.options.hint.async){this.finishUpdate(this.options.hint(this.cm,this.options),N)}else{var M=++this.tick,L=this;this.options.hint(this.cm,function(O){if(L.tick==M){L.finishUpdate(O,N)}},this.options)}},finishUpdate:function(N,L){if(this.data){I.signal(this.data,"update")}if(N&&this.data&&I.cmpPos(N.from,this.data.from)){N=null}this.data=N;var M=(this.widget&&this.widget.picked)||(L&&this.options.completeSingle);if(this.widget){this.widget.close()}if(N&&N.list.length){if(M&&N.list.length==1){this.pick(N,0)}else{this.widget=new G(this,N);I.signal(N,"shown")}}},buildOptions:function(L){var O=this.cm.options.hintOptions;var M={};for(var N in C){M[N]=C[N]}if(O){for(var N in O){if(O[N]!==undefined){M[N]=O[N]}}}if(L){for(var N in L){if(L[N]!==undefined){M[N]=L[N]}}}return M}};function D(L){if(typeof L=="string"){return L}else{return L.text}}function A(P,N){var O={Up:function(){N.moveFocus(-1)},Down:function(){N.moveFocus(1)},PageUp:function(){N.moveFocus(-N.menuSize()+1,true)},PageDown:function(){N.moveFocus(N.menuSize()-1,true)},Home:function(){N.setFocus(0)},End:function(){N.setFocus(N.length-1)},Enter:N.pick,Tab:N.pick,Esc:N.close};var M=P.options.customKeys;var Q=M?{}:O;function L(T,U){var V;if(typeof U!="string"){V=function(W){return U(W,N)}}else{if(O.hasOwnProperty(U)){V=O[U]}else{V=U}}Q[T]=V}if(M){for(var R in M){if(M.hasOwnProperty(R)){L(R,M[R])}}}var S=P.options.extraKeys;if(S){for(var R in S){if(S.hasOwnProperty(R)){L(R,S[R])}}}return Q}function J(M,L){while(L&&L!=M){if(L.nodeName.toUpperCase()==="LI"&&L.parentNode==M){return L}L=L.parentNode}}function G(Z,g){this.completion=Z;this.data=g;this.picked=false;var a=this,e=Z.cm;var c=this.hints=document.createElement("ul");c.className="CodeMirror-hints";this.selectedHint=g.selectedHint||0;var Q=g.list;for(var R=0;R<Q.length;++R){var L=c.appendChild(document.createElement("li")),N=Q[R];var X=H+(R!=this.selectedHint?"":" "+B);if(N.className!=null){X=N.className+" "+X}L.className=X;if(N.render){N.render(L,g,N)}else{L.appendChild(document.createTextNode(N.displayText||D(N)))}L.hintId=R}var h=e.cursorCoords(Z.options.alignWithWord?g.from:null);var f=h.left,U=h.bottom,b=true;c.style.left=f+"px";c.style.top=U+"px";var j=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var V=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(Z.options.container||document.body).appendChild(c);var P=c.getBoundingClientRect(),T=P.bottom-V;if(T>0){var d=P.bottom-P.top,Y=h.top-(h.bottom-P.top);if(Y-d>0){c.style.top=(U=h.top-d)+"px";b=false}else{if(d>V){c.style.height=(V-5)+"px";c.style.top=(U=h.bottom-P.top)+"px";var S=e.getCursor();if(g.from.ch!=S.ch){h=e.cursorCoords(S);c.style.left=(f=h.left)+"px";P=c.getBoundingClientRect()}}}}var O=P.right-j;if(O>0){if(P.right-P.left>j){c.style.width=(j-5)+"px";O-=(P.right-P.left)-j}c.style.left=(f=h.left-O)+"px"}e.addKeyMap(this.keyMap=A(Z,{moveFocus:function(k,i){a.changeActive(a.selectedHint+k,i)},setFocus:function(i){a.changeActive(i)},menuSize:function(){return a.screenAmount()},length:Q.length,close:function(){Z.close()},pick:function(){a.pick()},data:g}));if(Z.options.closeOnUnfocus){var M;e.on("blur",this.onBlur=function(){M=setTimeout(function(){Z.close()},100)});e.on("focus",this.onFocus=function(){clearTimeout(M)})}var W=e.getScrollInfo();e.on("scroll",this.onScroll=function(){var i=e.getScrollInfo(),m=e.getWrapperElement().getBoundingClientRect();var l=U+W.top-i.top;var k=l-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!b){k+=c.offsetHeight}if(k<=m.top||k>=m.bottom){return Z.close()}c.style.top=l+"px";c.style.left=(f+W.left-i.left)+"px"});I.on(c,"dblclick",function(i){var k=J(c,i.target||i.srcElement);if(k&&k.hintId!=null){a.changeActive(k.hintId);a.pick()}});I.on(c,"click",function(i){var k=J(c,i.target||i.srcElement);if(k&&k.hintId!=null){a.changeActive(k.hintId);if(Z.options.completeOnSingleClick){a.pick()}}});I.on(c,"mousedown",function(){setTimeout(function(){e.focus()},20)});I.signal(g,"select",Q[0],c.firstChild);return true}G.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var L=this.completion.cm;if(this.completion.options.closeOnUnfocus){L.off("blur",this.onBlur);L.off("focus",this.onFocus)}L.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var L=this;this.keyMap={Enter:function(){L.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(M,L){if(M>=this.data.list.length){M=L?this.data.list.length-1:0}else{if(M<0){M=L?0:this.data.list.length-1}}if(this.selectedHint==M){return}var N=this.hints.childNodes[this.selectedHint];N.className=N.className.replace(" "+B,"");N=this.hints.childNodes[this.selectedHint=M];N.className+=" "+B;if(N.offsetTop<this.hints.scrollTop){this.hints.scrollTop=N.offsetTop-3}else{if(N.offsetTop+N.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=N.offsetTop+N.offsetHeight-this.hints.clientHeight+3}}I.signal(this.data,"select",this.data.list[this.selectedHint],N)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};I.registerHelper("hint","auto",function(P,O){var Q=P.getHelpers(P.getCursor(),"hint"),L;if(Q.length){for(var M=0;M<Q.length;M++){var N=Q[M](P,O);if(N&&N.list.length){return N}}}else{if(L=P.getHelper(P.getCursor(),"hintWords")){if(L){return I.hint.fromList(P,{words:L})}}else{if(I.hint.anyword){return I.hint.anyword(P,O)}}}});I.registerHelper("hint","fromList",function(M,Q){var L=M.getCursor(),U=M.getTokenAt(L);var T=I.Pos(L.line,U.end);if(U.string&&/\w/.test(U.string[U.string.length-1])){var N=U.string,R=I.Pos(L.line,U.start)}else{var N="",R=T}var P=[];for(var O=0;O<Q.words.length;O++){var S=Q.words[O];if(S.slice(0,N.length)==N){P.push(S)}}if(P.length){return{list:P,from:R,to:T}}});I.commands.autocomplete=I.showHint;var C={hint:I.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:false,container:null,customKeys:null,extraKeys:null};I.defineOption("hintOptions",null)});