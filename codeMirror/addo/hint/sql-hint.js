(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"),require("../../mode/sql/sql"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../../mode/sql/sql"],A)}else{A(CodeMirror)}}})(function(H){var N;var F;var A;var S={QUERY_DIV:";",ALIAS_KEYWORD:"AS"};var J=H.Pos;function E(U){var T=U.doc.modeOption;if(T==="sql"){T="text/x-sql"}return H.resolveMode(T).keywords}function B(T){return typeof T=="string"?T:T.text}function I(V,U){if(!V.slice){return V[U]}for(var T=V.length-1;T>=0;T--){if(B(V[T])==U){return V[T]}}}function G(V){var U={};for(var T in V){if(V.hasOwnProperty(T)){U[T]=V[T]}}return U}function C(U,W){var V=U.length;var T=B(W).substr(0,V);return U.toUpperCase()===T.toUpperCase()}function L(V,U,W,T){for(var X in W){if(!W.hasOwnProperty(X)){continue}if(W.slice){X=W[X]}if(C(U,X)){V.push(T(X))}}}function K(T){if(T.charAt(0)=="."){T=T.substr(1)}return T.replace(/`/g,"")}function P(V){var U=B(V).split(".");for(var T=0;T<U.length;T++){U[T]="`"+U[T]+"`"}var W=U.join(".");if(typeof V=="string"){return W}V=G(V);V.text=W;return V}function R(T,g,Y,U){var W=false;var b=[];var V=g.start;var a=true;while(a){a=(g.string.charAt(0)==".");W=W||(g.string.charAt(0)=="`");V=g.start;b.unshift(K(g.string));g=U.getTokenAt(J(T.line,g.start));if(g.string=="."){a=true;g=U.getTokenAt(J(T.line,g.start))}}var X=b.join(".");L(Y,X,N,function(h){return W?P(h):h});L(Y,X,F,function(h){return W?P(h):h});X=b.pop();var c=b.join(".");var f=false;var e=c;if(!I(N,c)){var d=c;c=O(c,U);if(c!==d){f=true}}var Z=I(N,c);if(Z&&Z.columns){Z=Z.columns}if(Z){L(Y,X,Z,function(h){var i=c;if(f==true){i=e}if(typeof h=="string"){h=i+"."+h}else{h=G(h);h.text=i+"."+h.text}return W?P(h):h})}return V}function D(W,X){if(!W){return}var U=/[,;]/g;var T=W.split(" ");for(var V=0;V<T.length;V++){X(T[V]?T[V].replace(U,""):"")}}function M(T){return T.line+T.ch/Math.pow(10,6)}function Q(T){return J(Math.floor(T),+T.toString().split(".").pop())}function O(j,U){var d=U.doc;var c=d.getValue();var T=j.toUpperCase();var V="";var X="";var Z=[];var g={start:J(0,0),end:J(U.lastLine(),U.getLineHandle(U.lastLine()).length)};var f=c.indexOf(S.QUERY_DIV);while(f!=-1){Z.push(d.posFromIndex(f));f=c.indexOf(S.QUERY_DIV,f+1)}Z.unshift(J(0,0));Z.push(J(U.lastLine(),U.getLineHandle(U.lastLine()).text.length));var h=0;var W=M(U.getCursor());for(var b=0;b<Z.length;b++){var e=M(Z[b]);if(W>h&&W<=e){g={start:Q(h),end:Q(e)};break}h=e}var a=d.getRange(g.start,g.end,false);for(var b=0;b<a.length;b++){var Y=a[b];D(Y,function(k){var i=k.toUpperCase();if(i===T&&I(N,V)){X=V}if(i!==S.ALIAS_KEYWORD){V=k}});if(X){break}}return X}H.registerHelper("hint","sql",function(U,Z){N=(Z&&Z.tables)||{};var Y=Z&&Z.defaultTable;var c=Z&&Z.disableKeywords;F=Y&&I(N,Y);A=A||E(U);if(Y&&!F){F=O(Y,U)}F=F||[];if(F.columns){F=F.columns}var T=U.getCursor();var W=[];var X=U.getTokenAt(T),V,a,b;if(X.end>T.ch){X.end=T.ch;X.string=X.string.slice(0,T.ch-X.start)}if(X.string.match(/^[.`\w@]\w*$/)){b=X.string;V=X.start;a=X.end}else{V=a=T.ch;b=""}if(b.charAt(0)=="."||b.charAt(0)=="`"){V=R(T,X,W,U)}else{L(W,b,N,function(d){return d});L(W,b,F,function(d){return d});if(!c){L(W,b,A,function(d){return d.toUpperCase()})}}return{list:W,from:J(T.line,V),to:J(T.line,a)}})});