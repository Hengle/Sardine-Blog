(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(M){var D={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var F=M.Pos;M.defineOption("autoCloseBrackets",false,function(R,Q,P){if(P&&P!=M.Init){R.removeKeyMap(K);R.state.closeBrackets=null}if(Q){R.state.closeBrackets=Q;R.addKeyMap(K)}});function B(P,Q){if(Q=="pairs"&&typeof P=="string"){return P}if(typeof P=="object"&&P[Q]!=null){return P[Q]}return D[Q]}var L=D.pairs+"`";var K={Backspace:O,Enter:C};for(var H=0;H<L.length;H++){K["'"+L.charAt(H)+"'"]=J(L.charAt(H))}function J(P){return function(Q){return G(Q,P)}}function N(R){var Q=R.state.closeBrackets;if(!Q){return null}var P=R.getModeAt(R.getCursor());return P.closeBrackets||Q}function O(V){var S=N(V);if(!S||V.getOption("disableInput")){return M.Pass}var T=B(S,"pairs");var R=V.listSelections();for(var Q=0;Q<R.length;Q++){if(!R[Q].empty()){return M.Pass}var U=I(V,R[Q].head);if(!U||T.indexOf(U)%2!=0){return M.Pass}}for(var Q=R.length-1;Q>=0;Q--){var P=R[Q].head;V.replaceRange("",F(P.line,P.ch-1),F(P.line,P.ch+1))}}function C(U){var R=N(U);var S=R&&B(R,"explode");if(!S||U.getOption("disableInput")){return M.Pass}var Q=U.listSelections();for(var P=0;P<Q.length;P++){if(!Q[P].empty()){return M.Pass}var T=I(U,Q[P].head);if(!T||S.indexOf(T)%2!=0){return M.Pass}}U.operation(function(){U.replaceSelection("\n\n",null);U.execCommand("goCharLeft");Q=U.listSelections();for(var V=0;V<Q.length;V++){var W=Q[V].head.line;U.indentLine(W,null,true);U.indentLine(W+1,null,true)}})}function G(a,W){var b=N(a);if(!b||a.getOption("disableInput")){return M.Pass}var f=B(b,"pairs");var e=f.indexOf(W);if(e==-1){return M.Pass}var Z=B(b,"triples");var Q=f.charAt(e+1)==W;var U=a.listSelections();var X=e%2==0;var d,Y;for(var R=0;R<U.length;R++){var P=U[R],V=P.head,T;var Y=a.getRange(V,F(V.line,V.ch+1));if(X&&!P.empty()){T="surround"}else{if((Q||!X)&&Y==W){if(Z.indexOf(W)>=0&&a.getRange(V,F(V.line,V.ch+3))==W+W+W){T="skipThree"}else{T="skip"}}else{if(Q&&V.ch>1&&Z.indexOf(W)>=0&&a.getRange(F(V.line,V.ch-2),V)==W+W&&(V.ch<=2||a.getRange(F(V.line,V.ch-3),F(V.line,V.ch-2))!=W)){T="addFour"}else{if(Q){if(!M.isWordChar(Y)&&A(a,V,W)){T="both"}else{return M.Pass}}else{if(X&&(a.getLine(V.line).length==V.ch||E(Y,f)||/\s/.test(Y))){T="both"}else{return M.Pass}}}}}if(!d){d=T}else{if(d!=T){return M.Pass}}}var c=e%2?f.charAt(e-1):W;var S=e%2?W:f.charAt(e+1);a.operation(function(){if(d=="skip"){a.execCommand("goCharRight")}else{if(d=="skipThree"){for(var g=0;g<3;g++){a.execCommand("goCharRight")}}else{if(d=="surround"){var h=a.getSelections();for(var g=0;g<h.length;g++){h[g]=c+h[g]+S}a.replaceSelections(h,"around")}else{if(d=="both"){a.replaceSelection(c+S,null);a.triggerElectric(c+S);a.execCommand("goCharLeft")}else{if(d=="addFour"){a.replaceSelection(c+c+c+c,"before");a.execCommand("goCharRight")}}}}}})}function E(R,Q){var P=Q.lastIndexOf(R);return P>-1&&P%2==1}function I(R,P){var Q=R.getRange(F(P.line,P.ch-1),F(P.line,P.ch+1));return Q.length==2?Q:null}function A(U,R,S){var T=U.getLine(R.line);var P=U.getTokenAt(R);if(/\bstring2?\b/.test(P.type)){return false}var V=new M.StringStream(T.slice(0,R.ch)+S+T.slice(R.ch),4);V.pos=V.start=P.start;for(;;){var Q=U.getMode().token(V,P.state);if(V.pos>=R.ch+1){return/\bstring2?\b/.test(Q)}V.start=V.pos}}});